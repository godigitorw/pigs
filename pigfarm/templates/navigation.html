{% load static %}
{% load user_permissions %}
{% include 'offconvas.html' %}
<div data-bs-theme="">
  <nav class="navbar navbar-vertical fixed-start navbar-expand-md" id="sidebar">
    <div class="container-fluid">
      <!-- Toggler -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#sidebarCollapse"
        aria-controls="sidebarCollapse"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Brand -->
      <a class="navbar-brand text-start" href="{% url 'dashboard' %}">
        <img
          src="{% static 'assets/img/logo.png' %}"
          class="navbar-brand-img mx-auto"
          alt="..."
        />
      </a>

      <!-- User (xs) -->
      <div class="navbar-user d-md-none">
        <!-- Dropdown -->
        <div class="dropdown">
          <!-- Toggle -->
          <a
            href="#"
            id="sidebarIcon"
            class="dropdown-toggle"
            role="button"
            data-bs-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <div class="avatar avatar-sm avatar-online">
              <img
                src="{% static 'assets/img/avatars/profiles/avatar-1.jpg' %}"
                class="avatar-img rounded-circle"
                alt="..."
              />
            </div>
          </a>

          <!-- Menu -->
          <div
            class="dropdown-menu dropdown-menu-end"
            aria-labelledby="sidebarIcon"
          >
            <a href="profile-posts.html" class="dropdown-item">Profile</a>
            <a href="account-general.html" class="dropdown-item">Settings</a>
            <hr class="dropdown-divider" />
            <a href="{% url 'logout' %}" class="dropdown-item">Logout</a>
          </div>
        </div>
      </div>

      <!-- Collapse -->
      <div class="collapse navbar-collapse" id="sidebarCollapse">
        <!-- Form -->
        <form class="mt-4 mb-3 d-md-none">
          <div
            class="input-group input-group-rounded input-group-merge input-group-reverse"
          >
            <input
              class="form-control"
              type="search"
              placeholder="Search"
              aria-label="Search"
            />
            <div class="input-group-text">
              <span class="fe fe-search"></span>
            </div>
          </div>
        </form>

        <!-- Navigation -->

        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'dashboard' %}">
              <i class="fe fe-grid"></i> Dashboard
            </a>
          </li>
          <!-- Pigs Management - Only for Owner/Admin and Farm Manager -->
          {% if user.role and user.role.name == 'farm_owner' or user.role.name == 'farm_manager' %}
          <li class="nav-item">
            <a
              class="nav-link"
              href="#sidebarDashboards"
              data-bs-toggle="collapse"
              role="button"
              aria-expanded="true"
              aria-controls="sidebarDashboards"
            >
              <i class="fe fe-gitlab"></i> Pigs
            </a>
            <div class="collapse show" id="sidebarDashboards">
              <ul class="nav nav-sm flex-column">
                <li class="nav-item">
                  <a href="{% url 'room_list' %}" class="nav-link"> Rooms </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'sow_list' %}" class="nav-link"> Sows </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'piglets' %}" class="nav-link"> Piglets </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'inactive_pigs_list' %}" class="nav-link">
                    View Inactive Pigs
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'insemination_list' %}" class="nav-link">
                    Insemination Types
                  </a>
                </li>
              </ul>
            </div>
          </li>
          {% endif %}
          <!-- Feeding Management - For Owner/Admin and Farm Worker -->
          {% if user.role and user.role.name == 'farm_owner' or user.role.name == 'farm_worker' %}
          <li class="nav-item">
            <a
              class="nav-link"
              href="#food"
              data-bs-toggle="collapse"
              role="button"
              aria-expanded="true"
              aria-controls="food"
            >
              <i class="fe fe-shopping-bag"></i> Feeding
            </a>
            <div class="collapse show" id="food">
              <ul class="nav nav-sm flex-column">
                <li class="nav-item">
                  <a href="{% url 'feed_stock_list' %}" class="nav-link">
                    Feed Stock Management
                  </a>
                </li>
                <li
                  class="nav-item {% if request.path == '/feeding-records/' %}active{% endif %}"
                >
                  <a href="{% url 'feeding_records' %}" class="nav-link">
                    Feeding Records
                  </a>
                </li>
              </ul>
            </div>
          </li>
          {% endif %}

          <!-- Health Management - For Owner/Admin and Farm Worker -->
          {% if user.role and user.role.name == 'farm_owner' or user.role.name == 'farm_worker' %}
          <li class="nav-item">
            <a
              class="nav-link"
              href="#health"
              data-bs-toggle="collapse"
              role="button"
              aria-expanded="true"
              aria-controls="health"
            >
              <i class="fe fe-activity"></i> Health
            </a>
            <div class="collapse show" id="health">
              <ul class="nav nav-sm flex-column">
                <li class="nav-item">
                  <a href="{% url 'health_records' %}" class="nav-link">
                    Health Records
                  </a>
                </li>
                <li class="nav-item">
                  <a
                    href="#sidebarFeed"
                    class="nav-link"
                    data-bs-toggle="collapse"
                    role="button"
                    aria-expanded="false"
                    aria-controls="sidebarFeed"
                  >
                    Vaccination
                  </a>
                  <div class="collapse" id="sidebarFeed">
                    <ul class="nav nav-sm flex-column">
                      <li class="nav-item">
                        <a href="{% url 'vaccination_list' %}" class="nav-link">
                          Vaccinations
                        </a>
                      </li>
                      <li class="nav-item">
                        <a
                          href="{% url 'vaccination_records' %}"
                          class="nav-link"
                        >
                          Vaccination Records
                        </a>
                      </li>
                    </ul>
                  </div>
                </li>

                <li class="nav-item">
                  <a href="{% url 'weight_records_list' %}" class="nav-link">
                    Weight Records
                  </a>
                </li>
                <li class="nav-item">
                  <a
                    href="{% url 'breeding_records_list' %}"
                    class="nav-link {% if request.path == '/breeding/records/' %}active{% endif %}"
                  >
                    <i class="bi bi-gender-female"></i>
                    <!-- Optional icon -->
                    Breeding Records
                  </a>
                </li>
              </ul>
            </div>
          </li>
          {% endif %}

          <!-- Financial Records - Only for Owner/Admin -->
          {% if user.role and user.role.name == 'farm_owner' %}
          <li class="nav-item">
            <a
              class="nav-link {% if request.path == '/income/' %}active{% endif %}"
              href="{% url 'income_list' %}"
            >
              <i class="fe fe-briefcase"></i> Income Records
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{% url 'expense_list' %}">
              <i class="fe fe-dollar-sign me-2"></i> Expenses
            </a>
          </li>
          {% endif %}

          <!-- Reports Section - Only for Owner/Admin -->
          {% if user.role and user.role.name == 'farm_owner' %}
          <li class="nav-item">
            <a
              class="nav-link"
              href="#reports"
              data-bs-toggle="collapse"
              role="button"
              aria-expanded="false"
              aria-controls="reports"
            >
              <i class="fe fe-bar-chart-2"></i> Reports
            </a>
            <div class="collapse" id="reports">
              <ul class="nav nav-sm flex-column">
                <li class="nav-item">
                  <a href="{% url 'finance_report' %}" class="nav-link">
                    Finance Report
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'piglet_births_report' %}" class="nav-link">
                    Piglet Births Report
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'sow_report' %}" class="nav-link">
                    Sow Report
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'weight_report' %}" class="nav-link">
                    Weight Report
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'feeding_cost_report' %}" class="nav-link">
                    Feeding Cost Report
                  </a>
                </li>
              </ul>
            </div>
          </li>
          {% endif %}

          <!-- User Management Section - Only for Owner/Admin -->
          {% if user.role and user.role.name == 'farm_owner' %}
          <li class="nav-item">
            <a
              class="nav-link"
              href="#userManagement"
              data-bs-toggle="collapse"
              role="button"
              aria-expanded="false"
              aria-controls="userManagement"
            >
              <i class="fe fe-users"></i> User Management
            </a>
            <div class="collapse" id="userManagement">
              <ul class="nav nav-sm flex-column">
                {% if user.role.name == 'farm_owner' %}
                <li class="nav-item">
                  <a href="{% url 'users:user_management' %}" class="nav-link">
                    <i class="fe fe-user-plus"></i> Manage Users
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'users:role_permissions' %}" class="nav-link">
                    <i class="fe fe-shield"></i> Roles & Permissions
                  </a>
                </li>
                <li class="nav-item">
                  <a href="{% url 'users:user_sessions' %}" class="nav-link">
                    <i class="fe fe-monitor"></i> Active Sessions
                  </a>
                </li>
                {% endif %}
                <li class="nav-item">
                  <a href="{% url 'users:activity_logs' %}" class="nav-link">
                    <i class="fe fe-activity"></i> Activity Logs
                  </a>
                </li>
              </ul>
            </div>
          </li>
          {% endif %}
        </ul>

        <!-- Push content down -->
        <div class="mt-auto"></div>

        <!-- Customize -->

        <!-- User (md) -->
        <div
          class="navbar-user d-none d-md-flex flex-column align-items-start"
          id="sidebarUser"
        >
          <div class="d-flex align-items-center w-100 mb-2">
            <div class="avatar avatar-sm me-2">
              {% if request.user.profile_picture %}
                <img src="{{ request.user.profile_picture.url }}" class="avatar-img rounded-circle" alt="Profile">
              {% else %}
                <div class="avatar-img rounded-circle bg-primary text-white d-flex align-items-center justify-content-center">
                  {{ request.user.first_name|first|default:request.user.username|first|upper }}
                </div>
              {% endif %}
            </div>
            <div class="flex-fill">
              <span class="fw-semibold text-dark d-block">
                {{ request.user.get_full_name|default:request.user.username }}
              </span>
              {% if request.user.role %}
                <small class="text-muted">{{ request.user.role.display_name }}</small>
              {% endif %}
            </div>
          </div>
          <div class="d-flex w-100">
            <a href="{% url 'users:profile' %}" class="btn btn-sm btn-outline-secondary me-2">
              <i class="fe fe-user me-1"></i> Profile
            </a>
            <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-danger">
              <i class="fe fe-log-out me-1"></i> Logout
            </a>
          </div>
        </div>
      </div>
      <!-- / .navbar-collapse -->
    </div>
  </nav>
</div>
